import { createContext, useContext, useMemo, useState } from 'react'
import type { ReactNode } from 'react'
import { TOKEN_SYMBOL } from '@/lib/currency'

export type Lang = 'en' | 'ja'

type Dict = Record<string, Record<Lang, string>>

const dict: Dict = {
  'nav.overview': { en: 'Overview', ja: '概要' },
  'nav.dashboard': { en: 'Dashboard', ja: 'ダッシュボード' },
  'nav.banking': { en: 'Banking', ja: 'バンキング' },
  'nav.profile': { en: 'My Profile', ja: 'マイプロフィール' },
  'nav.products': { en: 'Products & Pricing', ja: '商品と価格' },
  'nav.calculator': { en: 'FD Calculator', ja: '定期預金計算機' },
  'nav.accounts': { en: 'My Accounts', ja: '口座' },
  'nav.admin': { en: 'Administration', ja: '管理' },
  'nav.admin.dashboard': { en: 'Admin Dashboard', ja: '管理ダッシュボード' },
  'brand.subtitle': { en: 'CashCached Digital Banking', ja: 'CashCached デジタルバンキング' },
  'action.logout': { en: 'Log out', ja: 'ログアウト' },
  'action.refresh': { en: 'Refresh', ja: '更新' },
  'action.exportCsv': { en: 'Export CSV', ja: 'CSV エクスポート' },
  'action.close': { en: 'Close', ja: '閉じる' },
  'action.viewDetails': { en: 'View Details', ja: '詳細を見る' },
  'accounts.all': { en: 'All Accounts', ja: 'すべての口座' },
  'accounts.mine': { en: 'My Accounts', ja: 'マイ口座' },
  'accounts.subtitle.admin': { en: 'Manage and monitor all customer accounts', ja: 'すべての顧客口座を管理・監視' },
  'accounts.subtitle.customer': { en: 'View and manage your fixed deposit accounts', ja: '自分の定期預金口座を表示・管理' },
  'accounts.openNew': { en: 'Open New Account', ja: '新規口座開設' },
  'accounts.searchPlaceholder': { en: 'Search accounts...', ja: '口座を検索...' },
  'accounts.filter.status': { en: 'Status', ja: 'ステータス' },
  'accounts.filter.allStatus': { en: 'All Status', ja: 'すべてのステータス' },
  'accounts.filter.type': { en: 'Type', ja: '種類' },
  'accounts.filter.allTypes': { en: 'All Types', ja: 'すべての種類' },
  'status.active': { en: 'Active', ja: '有効' },
  'status.matured': { en: 'Matured', ja: '満期' },
  'status.closed': { en: 'Closed', ja: '解約済み' },
  'status.inactive': { en: 'Inactive', ja: '無効' },
  'type.fd': { en: 'Fixed Deposit', ja: '定期預金' },
  'type.rd': { en: 'Recurring Deposit', ja: '積立預金' },
  'type.savings': { en: 'Savings', ja: '普通預金' },
  'accounts.empty.title': { en: 'No accounts found', ja: '口座が見つかりません' },
  'accounts.empty.adjustFilters': { en: 'Try adjusting your search or filter criteria', ja: '検索やフィルター条件を調整してください' },
  'accounts.empty.noneAdmin': { en: 'No accounts are currently registered', ja: '現在登録されている口座はありません' },
  'accounts.empty.noneCustomer': { en: "You don't have any accounts yet. Open your first account to get started.", ja: 'まだ口座がありません。まずは口座を開設してください。' },
  'accounts.card.account': { en: 'Account', ja: '口座番号' },
  'accounts.card.currentBalance': { en: 'Current Balance', ja: '現在残高' },
  'accounts.card.interestRate': { en: 'Interest Rate', ja: '金利' },
  'accounts.card.principal': { en: 'Principal Amount', ja: '元本' },
  'accounts.card.maturityDate': { en: 'Maturity Date', ja: '満期日' },
  'accounts.card.opened': { en: 'Opened', ja: '開設日' },
  'details.title': { en: 'Account Details', ja: '口座詳細' },
  'details.back': { en: 'Back to Accounts', ja: '口座一覧に戻る' },
  'details.tabs.overview': { en: 'Overview', ja: '概要' },
  'details.tabs.transactions': { en: 'Transactions', ja: '取引' },
  'details.tabs.documents': { en: 'Documents', ja: '書類' },
  'details.info': { en: 'Account Information', ja: '口座情報' },
  'details.accountNumber': { en: 'Account Number', ja: '口座番号' },
  'details.accountType': { en: 'Account Type', ja: '口座種類' },
  'details.productName': { en: 'Product Name', ja: '商品名' },
  'details.status': { en: 'Status', ja: 'ステータス' },
  'details.financial': { en: 'Financial Details', ja: '財務情報' },
  'details.currentBalance': { en: 'Current Balance', ja: '現在残高' },
  'details.principal': { en: 'Principal Amount', ja: '元本' },
  'details.interestRate': { en: 'Interest Rate', ja: '金利' },
  'details.interestEarned': { en: 'Interest Earned', ja: '獲得利息' },
  'details.txn.title': { en: 'Transaction History', ja: '取引履歴' },
  'details.txn.subtitle': { en: 'View all transactions for this account', ja: 'この口座の全取引を表示' },
  'details.txn.load': { en: 'Load Transactions', ja: '取引を読み込む' },
  'details.txn.empty': { en: 'No transactions found', ja: '取引はありません' },
  'details.dates': { en: 'Key Dates', ja: '重要な日付' },
  'details.opened': { en: 'Account Opened', ja: '開設日' },
  'details.maturityDate': { en: 'Maturity Date', ja: '満期日' },
  'details.daysToMaturity': { en: 'Days to Maturity', ja: '満期までの日数' },
  'details.customerInfo': { en: 'Customer Information', ja: '顧客情報' },
  'details.deposit.label': { en: 'Deposit', ja: '入金' },
  'details.deposit.action': { en: 'Add', ja: '追加' },
  'details.withdraw.label': { en: 'Withdraw', ja: '出金' },
  'details.withdraw.action': { en: 'Withdraw', ja: '出金する' },
  'details.notFound.title': { en: 'Account not found', ja: '口座が見つかりません' },
  'details.notFound.desc': { en: "The account you're looking for doesn't exist or you don't have permission to view it.", ja: 'お探しの口座は存在しないか、表示権限がありません。' },
  'action.download': { en: 'Download', ja: 'ダウンロード' },
  'action.share': { en: 'Share', ja: '共有' },
  'calculator.title': { en: 'FD Calculator', ja: '定期預金計算機' },
  'calculator.subtitle': { en: 'Calculate your fixed deposit returns and plan your investments', ja: '定期預金のリターンを計算し、投資計画を立てましょう' },
  'calculator.badge': { en: 'Investment Calculator', ja: '投資計算機' },
  'calculator.calculateHeadline': { en: 'Calculate FD Returns', ja: '定期預金のリターンを計算' },
  'calculator.section.inputs': { en: 'Simulation Inputs', ja: 'シミュレーション入力' },
  'calculator.section.inputsDesc': { en: 'Choose a product and fill in the deposit details to run the projection.', ja: '商品を選び、預入条件を入力してシミュレーションを実行します。' },
  'calculator.product': { en: 'Product', ja: '商品' },
  'calculator.principal': { en: `Principal Amount (${TOKEN_SYMBOL})`, ja: `元本 (${TOKEN_SYMBOL})` },
  'calculator.principalTokens': { en: `Principal Amount (${TOKEN_SYMBOL})`, ja: `元本 (${TOKEN_SYMBOL})` },
  'calculator.tenureYears': { en: 'Tenure (Years)', ja: '期間 (年)' },
  'calculator.compounding': { en: 'Compounding', ja: '複利頻度' },
  'calculator.monthly': { en: 'Monthly', ja: '毎月' },
  'calculator.quarterly': { en: 'Quarterly', ja: '四半期' },
  'calculator.yearly': { en: 'Yearly', ja: '毎年' },
  'calculator.calculate': { en: 'Calculate', ja: '計算する' },
  'calculator.results': { en: 'Results', ja: '結果' },
  'calculator.result.principal': { en: `Principal (${TOKEN_SYMBOL})`, ja: `元本 (${TOKEN_SYMBOL})` },
  'calculator.result.interest': { en: `Interest Earned (${TOKEN_SYMBOL})`, ja: `獲得利息 (${TOKEN_SYMBOL})` },
  'calculator.result.maturity': { en: `Maturity Amount (${TOKEN_SYMBOL})`, ja: `満期金額 (${TOKEN_SYMBOL})` },
  'calculator.calculating': { en: 'Calculating...', ja: '計算中...' },
  'calculator.calculateReturns': { en: 'Calculate', ja: '計算する' },
  'calculator.quickCalculations': { en: 'Quick Calculations', ja: 'クイック計算' },
  'calculator.quick.title': { en: 'Quick Scenarios', ja: 'クイックシナリオ' },
  'calculator.quick.subtitle': { en: 'Pre-built examples to explore typical deposits', ja: '代表的な預入例をすばやく確認できます。' },
  'calculator.commonFdScenarios': { en: 'Common FD scenarios', ja: '一般的な定期預金の例' },
  'calculator.calculationResults': { en: 'Calculation Results', ja: '計算結果' },
  'calculator.investmentBreakdown': { en: 'Investment breakdown', ja: '投資内訳' },
  'calculator.result.maturityAmount': { en: 'Maturity Amount', ja: '満期金額' },
  'calculator.result.tenure': { en: 'Tenure', ja: '期間' },
  'calculator.result.years': { en: 'years', ja: '年' },
  'calculator.result.effectiveRate': { en: 'Effective Rate', ja: '実効利回り' },
  'calculator.totalReturn': { en: 'Total return', ja: '総リターン' },
  'calculator.enterFdDetails': { en: 'Enter the FD details to see results', ja: '結果を表示するには定期預金の詳細を入力してください' },
  'calculator.noCalculation': { en: 'No calculation yet', ja: 'まだ計算がありません' },
  'calculator.fillForm': { en: 'Fill in the form to see results', ja: 'フォームに入力すると結果が表示されます' },
  'calculator.loadingProducts': { en: 'Loading products...', ja: '商品を読み込み中...' },
  'calculator.selectProduct': { en: 'Select a product', ja: '商品を選択' },
  'calculator.error.calcFailed': { en: 'Failed to calculate FD returns', ja: '定期預金の計算に失敗しました' },
  'calculator.error.productCodeInvalid': { en: 'Selected product code is not compatible with calculator. Please choose a product with a hyphenated code (A-Z, 0-9, - only, max 20 chars).', ja: '選択した商品コードは計算機に対応していません。ハイフン区切りのコード（A-Z・0-9・- のみ、最大20文字）を持つ商品を選択してください。' },
  'calculator.error.enterProductFirst': { en: 'Please enter a product code first', ja: '先に商品コードを入力してください' },
  'calculator.tips.title': { en: 'FD Calculator Tips', ja: '定期預金計算のヒント' },
  'calculator.tips.higherTenure.title': { en: 'Higher Tenure = Better Returns', ja: '長期期間 = 高いリターン' },
  'calculator.tips.higherTenure.desc': { en: 'Longer-term FDs typically offer higher interest rates.', ja: '長期間の定期預金は、一般的により高い金利が適用されます。' },
  'calculator.tips.compounding.title': { en: 'Compounding Frequency', ja: '複利頻度' },
  'calculator.tips.compounding.desc': { en: 'More frequent compounding (monthly/quarterly) yields better returns.', ja: '複利の頻度（毎月・四半期）が高いほど、リターンが向上します。' },
  'calculator.tips.tax.title': { en: 'Tax Implications', ja: '税制上の注意' },
  'calculator.tips.tax.desc': { en: 'FD interest is taxable as per your income tax slab.', ja: '定期預金の利息は、所得税率に応じて課税されます。' },
  'calculator.validation.notes': { en: 'Notes', ja: '注意事項' },
  'calculator.validation.tenure': { en: 'Product tenure valid range', ja: '商品適用期間' },
  'calculator.validation.amount': { en: 'Investment range', ja: '投資範囲' },
  'calculator.validation.freq': { en: 'Compounding frequency restricted to annual for this product', ja: 'この商品の複利頻度は年次のみです' },
  'calculator.validation.reason': { en: 'Reason', ja: '理由' },
  'products.title': { en: 'Products & Pricing', ja: '商品と価格' },
  'products.calculate': { en: 'Calculate', ja: '計算' },
  'products.edit': { en: 'Edit', ja: '編集' },
  'products.addProduct': { en: 'Add Product', ja: '商品を追加' },
  'products.empty.title': { en: 'No products found', ja: '商品が見つかりません' },
  'products.empty.adjustFilters': { en: 'Try adjusting your search or filter criteria', ja: '検索条件やフィルターを調整してください' },
  'products.empty.none': { en: 'No banking products are currently available', ja: '現在、利用可能な銀行商品はありません' },
  'products.sort.name': { en: 'Name', ja: '名称' },
  'products.sort.rate': { en: 'Interest Rate', ja: '金利' },
  'products.sort.amount': { en: 'Min Amount', ja: '最小金額' },
  'products.sort.tenure': { en: 'Tenure', ja: '期間' },
  'products.investmentRange': { en: 'Investment Range', ja: '投資範囲' },
  'products.confirm.delete': { en: 'Are you sure you want to delete this product?', ja: 'この商品を削除してもよろしいですか？' },
  'products.toast.deleted': { en: 'Product deleted successfully', ja: '商品を削除しました' },
  'products.toast.deleteFailed': { en: 'Failed to delete product', ja: '商品の削除に失敗しました' },
  'products.toast.loadFailed': { en: 'Failed to load products', ja: '商品の読み込みに失敗しました' },
  'dashboard.title': { en: 'Dashboard', ja: 'ダッシュボード' },
  'dashboard.greeting.morning': { en: 'Good morning', ja: 'おはようございます' },
  'dashboard.greeting.afternoon': { en: 'Good afternoon', ja: 'こんにちは' },
  'dashboard.greeting.evening': { en: 'Good evening', ja: 'こんばんは' },
  'dashboard.subtitle': { en: 'Welcome to your CashCached dashboard', ja: 'CashCachedダッシュボードへようこそ' },
  'dashboard.card.totalBalance': { en: 'Total Balance', ja: '総残高' },
  'dashboard.card.activeAccounts': { en: 'Active Accounts', ja: '有効口座' },
  'dashboard.card.availableProducts': { en: 'Available Products', ja: '利用可能な商品' },
  'dashboard.card.recentTransactions': { en: 'Recent Transactions', ja: '最近の取引' },
  'dashboard.quick.title': { en: 'Quick Actions', ja: 'クイック操作' },
  'dashboard.quick.subtitle': { en: 'Access your most used banking features', ja: 'よく使う機能にアクセス' },
  'dashboard.quick.calculator.title': { en: 'FD Calculator', ja: '定期預金計算機' },
  'dashboard.quick.calculator.desc': { en: 'Calculate your fixed deposit returns', ja: '定期預金のリターンを計算' },
  'dashboard.quick.accounts.title': { en: 'My Accounts', ja: 'マイ口座' },
  'dashboard.quick.accounts.desc': { en: 'View your account details', ja: '口座詳細を表示' },
  'dashboard.quick.products.title': { en: 'Products', ja: '商品' },
  'dashboard.quick.products.desc': { en: 'Explore banking products', ja: '銀行商品の閲覧' },
  'dashboard.quick.profile.title': { en: 'Profile', ja: 'プロフィール' },
  'dashboard.quick.profile.desc': { en: 'Manage your profile', ja: 'プロフィール管理' },
  'dashboard.activity.title': { en: 'Recent Activity', ja: '最近のアクティビティ' },
  'dashboard.activity.subtitle': { en: 'Your latest banking activities', ja: '最近の銀行活動' },
  'dashboard.activity.accountOpened': { en: 'Account opened', ja: '口座開設' },
  'dashboard.activity.accountOpened.desc': { en: 'Fixed Deposit account created', ja: '定期預金口座を作成しました' },
  'dashboard.activity.calculatorUsed': { en: 'FD Calculator used', ja: '計算機を使用' },
  'dashboard.activity.calculatorUsed.desc': { en: `Calculated returns for 100,000 ${TOKEN_SYMBOL}`, ja: `100,000 ${TOKEN_SYMBOL}のリターンを計算しました` },
  'dashboard.activity.productViewed': { en: 'Product viewed', ja: '商品を閲覧' },
  'dashboard.activity.productViewed.desc': { en: 'Fixed Deposit product details', ja: '定期預金商品の詳細' },
  'dashboard.activity.today': { en: 'Today', ja: '今日' },
  'dashboard.activity.yesterday': { en: 'Yesterday', ja: '昨日' },
  'dashboard.activity.daysAgo2': { en: '2 days ago', ja: '2日前' },
  'common.search': { en: 'Search...', ja: '検索...' },
  'common.category': { en: 'Category', ja: 'カテゴリ' },
  'common.allCategories': { en: 'All Categories', ja: 'すべてのカテゴリ' },
  'common.sortBy': { en: 'Sort by', ja: '並び替え' },
  'common.year': { en: 'year', ja: '年' },
  'common.years': { en: 'years', ja: '年' },
  'common.months': { en: 'months', ja: 'ヶ月' },
  'common.to': { en: 'to', ja: '〜' },
  'calculator.interestRate': { en: 'Interest Rate', ja: '金利' },
  'auth.login.title': { en: 'Sign in', ja: 'ログイン' },
  'auth.login.username': { en: 'Username', ja: 'ユーザー名' },
  'auth.login.password': { en: 'Password', ja: 'パスワード' },
  'auth.login.submit': { en: 'Log in', ja: 'ログイン' },
  'auth.login.welcome': { en: 'Welcome back', ja: 'お帰りなさい' },
  'auth.login.subtitle': { en: 'Sign in to your CashCached account to continue', ja: 'CashCachedアカウントにログインしてください' },
  'auth.login.signingIn': { en: 'Signing in...', ja: 'ログイン中...' },
  'auth.login.noAccount': { en: "Don't have an account?", ja: 'アカウントをお持ちでない場合' },
  'auth.login.signUp': { en: 'Sign up', ja: '新規登録' },
  'auth.register.title': { en: 'Create account', ja: 'アカウント作成' },
  'auth.register.submit': { en: 'Register', ja: '登録' },
  'auth.register.subtitle': { en: 'Sign up for a new CashCached account', ja: '新しいCashCachedアカウントを作成' },
  'auth.register.creating': { en: 'Creating account...', ja: 'アカウント作成中...' },
  'auth.register.haveAccount': { en: 'Already have an account?', ja: 'すでにアカウントをお持ちですか？' },
  'auth.register.signIn': { en: 'Sign in', ja: 'ログイン' },
  'auth.field.firstName': { en: 'First Name', ja: '名' },
  'auth.field.lastName': { en: 'Last Name', ja: '姓' },
  'auth.field.email': { en: 'Email', ja: 'メール' },
  'auth.field.username': { en: 'Username', ja: 'ユーザー名' },
  'auth.field.phone': { en: 'Phone Number', ja: '電話番号' },
  'auth.field.role': { en: 'Role', ja: '権限' },
  'auth.field.password': { en: 'Password', ja: 'パスワード' },
  'auth.field.confirmPassword': { en: 'Confirm Password', ja: 'パスワード確認' },
  'auth.placeholder.username': { en: 'Enter your username', ja: 'ユーザー名を入力' },
  'auth.placeholder.password': { en: 'Enter your password', ja: 'パスワードを入力' },
  'auth.placeholder.confirmPassword': { en: 'Confirm your password', ja: 'パスワードを再入力' },
  'auth.placeholder.email': { en: 'Enter your email address', ja: 'メールアドレスを入力' },
  'auth.placeholder.phone': { en: 'Enter your phone number', ja: '電話番号を入力' },
  'auth.placeholder.firstName': { en: 'Enter your first name', ja: '名を入力' },
  'auth.placeholder.lastName': { en: 'Enter your last name', ja: '姓を入力' },
  'auth.placeholder.role': { en: 'Select a role', ja: '権限を選択' },
  'profile.title': { en: 'My Profile', ja: 'マイプロフィール' },
  'profile.update': { en: 'Update Profile', ja: 'プロフィール更新' },
  'profile.subtitle': { en: 'Manage your personal information and account settings', ja: '個人情報とアカウント設定を管理' },
  'profile.edit': { en: 'Edit Profile', ja: 'プロフィールを編集' },
  'profile.cancel': { en: 'Cancel', ja: 'キャンセル' },
  'profile.saving': { en: 'Saving...', ja: '保存中...' },
  'profile.saveChanges': { en: 'Save Changes', ja: '変更を保存' },
  'profile.tabs.personal': { en: 'Personal Information', ja: '個人情報' },
  'profile.tabs.security': { en: 'Security', ja: 'セキュリティ' },
  'profile.section.personal.title': { en: 'Personal Information', ja: '個人情報' },
  'profile.section.personal.desc': { en: 'Update your personal details and contact information', ja: '個人情報と連絡先を更新' },
  'profile.field.firstName': { en: 'First Name', ja: '名' },
  'profile.field.lastName': { en: 'Last Name', ja: '姓' },
  'profile.field.email': { en: 'Email Address', ja: 'メールアドレス' },
  'profile.field.phone': { en: 'Phone Number', ja: '電話番号' },
  'profile.field.address': { en: 'Address', ja: '住所' },
  'profile.field.dob': { en: 'Date of Birth', ja: '生年月日' },
  'profile.placeholder.firstName': { en: 'Enter your first name', ja: '名を入力' },
  'profile.placeholder.lastName': { en: 'Enter your last name', ja: '姓を入力' },
  'profile.placeholder.email': { en: 'Enter your email address', ja: 'メールアドレスを入力' },
  'profile.placeholder.phone': { en: 'Enter your phone number', ja: '電話番号を入力' },
  'profile.placeholder.address': { en: 'Enter your address', ja: '住所を入力' },
  'profile.section.security.title': { en: 'Security Settings', ja: 'セキュリティ設定' },
  'profile.section.security.desc': { en: 'Manage your account security and privacy settings', ja: 'アカウントのセキュリティとプライバシーを管理' },
  'profile.security.2fa.title': { en: 'Two-Factor Authentication', ja: '2段階認証' },
  'profile.security.2fa.desc': { en: 'Add an extra layer of security to your account', ja: 'アカウントにセキュリティを追加' },
  'profile.security.2fa.enable': { en: 'Enable', ja: '有効化' },
  'profile.security.changePassword.title': { en: 'Change Password', ja: 'パスワード変更' },
  'profile.security.changePassword.desc': { en: 'Update your account password', ja: 'アカウントのパスワードを更新' },
  'profile.security.changePassword.change': { en: 'Change', ja: '変更' },
  'profile.security.loginActivity.title': { en: 'Login Activity', ja: 'ログイン履歴' },
  'profile.security.loginActivity.desc': { en: 'View your recent login history', ja: '最近のログイン履歴を表示' },
  'profile.security.loginActivity.view': { en: 'View', ja: '表示' },
  'profile.status': { en: 'Account Status:', ja: 'アカウントの状態:' },
  'profile.status.active': { en: 'Active', ja: '有効' },
  'profile.memberSince': { en: 'Member since:', ja: '登録日:' },
  'profile.lastLogin': { en: 'Last login:', ja: '最終ログイン:' },
}

interface I18nContextType {
  lang: Lang
  setLang: (l: Lang) => void
  t: (key: string) => string
}

const I18nContext = createContext<I18nContextType | undefined>(undefined)

export function I18nProvider({ children }: { children: ReactNode }) {
  const [lang, setLang] = useState<Lang>('en')
  const missing = useMemo(() => new Set<string>(), [])

  const t = (key: string) => {
    const item = dict[key]
    if (!item) {
      if (!missing.has(`${key}.missing`)) {
        missing.add(`${key}.missing`)
        console.warn(`[i18n] Missing key: ${key}`)
      }
      return key
    }
    const value = item[lang] ?? item.en
    if (item[lang] == null && !missing.has(`${key}.${lang}`)) {
      missing.add(`${key}.${lang}`)
      console.warn(`[i18n] Missing locale for key: ${key}.${lang}`)
    }
    return value
  }

  const value = useMemo(() => ({ lang, setLang, t }), [lang])
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>
}

export function useI18n() {
  const ctx = useContext(I18nContext)
  if (!ctx) throw new Error('useI18n must be used within I18nProvider')
  return ctx
}
